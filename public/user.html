<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>My PUGS Feed</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
  <!-- Bootstrap core CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <!-- Material Design Bootstrap -->
  <link href="css/mdb.min.css" rel="stylesheet">
  <!-- Your custom styles (optional) -->
  <link href="css/style.css" rel="stylesheet">
  <!-- google font -->
  <link href="https://fonts.googleapis.com/css?family=Josefin+Sans:400,600,700&display=swap" rel="stylesheet">


</head>

<body>
  <div class="bg-main tempting-azure-gradient">
    <div class="container-fluid">
      <!-- Card -->
      <div class="row">
        <div class="col-md-4 col-sm-12">
          <div class="card testimonial-card" id="userCard">

            <!-- Background color -->
            <div class="card-up"></div>

            <!-- Avatar -->
            <div class="avatar mx-auto white">
              <img src="https://mdbootstrap.com/img/Photos/Avatars/img%20%2810%29.jpg" class="rounded-circle"
                alt="woman avatar">
            </div>

            <!-- Content -->
            <div  class="card-body">
                <div id='currentUser' class='text-center'>

                </div>
              <!-- Name -->
                <button class="btn btn-primary" id="createEvent-btn" data-toggle="modal" data-target="#modalEvent">Create
                Event</button>
            </div>

          </div>
        </div>
        <!-- /card -->

        <!-- Weather Widget -->

        <div class="col-md-6 offset-1 mt-3 mb-5" id="axu">
          <div class="card card-cascade mb-5 p-0">
            <!-- Card image -->
            <div class="view view-cascade gradient-card-header heavy-rain-gradient  p-1 flex-row">
              <!-- Title -->
              <h2 class="row card-header-title m-0" id="currentTemp">News Title</h2>
              <!-- Text -->
            </div>
            <!-- Card content -->
            <div class="card-body card-body-cascade text-center">
              <ul class="list-group list-group-horizontal containingGroup" id="weatherListDiv">
              </ul>
            </div>
            <!-- Card content -->

          </div>
          <!-- <ul class="list-group list-group-horizontal containingGroup z-depth-1-half" id="weatherListDiv">
          </ul> -->

        </div>

        <!-- /weather widget -->

      </div>
      <!-- /Card -->

      <!-- My Pugs Card -->
      <div class="row">
        <div class="col-md-4">
          <div class="card" id="myPugs">
            <div class="card-header text-center">
              My PUGS
            </div>
            <ul id='listPugs' class="list-group list-group-flush text-left">
            </ul>
          </div>
        </div>
        <!-- Feed Div -->
        <div class="col-md-6 offset-1 eventDiv">
          <div class="card" id="allEvents">
          </div>
        </div>
        <!-- /Feed Div -->
      </div>
      <!-- /My Pugs Card -->
      <!-- Copyright Card -->
      <div class="row">
        <div class="col-md-4 ml-4 text-center">
          <div class="card" id="copyRightCard">
            <div class="card-body">
              <p class="card-title text-muted text-smaller text-small">2019 © Pick Up Games!</p>
            </div>
          </div>
        </div>

      </div>
    <!-- container div -->
    </div>
    <!-- bg div -->
  </div>

  <!-- /page end-->


  <!-- Modal: modalPoll -->


  <div class="modal fade" id="modalEvent" tabindex="-1" role="dialog" aria-labelledby="modalEvent" aria-hidden="true">
    <div class="modal-dialog modal-notify modal-info" role="document">
      <div class="modal-content">
        <!--Header-->
        <div class="modal-header aqua-gradient">
          <p class="heading lead font-weight-bold">Create A PUG!
          </p>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true" class="white-text">×</span>
          </button>
        </div>

        <!--Body-->
        <div class="modal-body">
          <div class="text-center">
            <i class="far fa-calendar-plus fa-4x mb-3 animated rotateIn"></i>
          </div>

          <hr>

          <div class="form-group">
            <label for="materialContactFormName" class="pl-1">EVENT:</label>
            <input type="text" id="materialContactFormName" class="form-control pl-1 event-input">

          </div>
          <!-- Radio -->
          <div class="row">
            <div class="form-group col-6">
              <label for="event_Time" class="pl-1">EVENT TIME:</label>
              <input class="form-control event-input" type="time" id="event_Time">
            </div>
            <!-- Location -->
            <div class="form-group col-6">
              <label for="event_Loc" class="pl-1">CITY/STATE:</label>
              <select class="browser-default custom-select event-input" id="event_Loc">
                <option selected>Location</option>
                <option value="APPLE VALLEY">APPLE VALLEY</option>
                <option value="BLAINE">BLAINE</option>
                <option value="BLOOMINGTON">BLOOMINGTON</option>
                <option value="BROOKLYN PARK">BROOKLYN PARK</option>
                <option value="BURNSVILLE">BURNSVILLE</option>
                <option value="COON RAPIDS">COON RAPIDS</option>
                <option value="DULUTH">DULUTH</option>
                <option value="EAGAN">EAGAN</option>
                <option value="EDEN PRAIRIE">EDEN PRAIRIE</option>
                <option value="EDINA">EDINA</option>
                <option value="LAKEVILLE">LAKEVILLE</option>
                <option value="MAPLE GROVE">MAPLE GROVE</option>
                <option value="MINNEAPOLIS">MINNEAPOLIS</option>
                <option value="MINNETONKA">MINNETONKA</option>
                <option value="PLYMOUTH">PLYMOUTH</option>
                <option value="ROCHESTER">ROCHESTER</option>
                <option value="ST. CLOUD">ST. CLOUD</option>
                <option value="ST. LOUIS PARK">ST. LOUIS PARK</option>
                <option value="ST. PAUL">ST. PAUL</option>
                <option value="WOODBURY">WOODBURY</option>
              </select>
            </div>
          </div>
          <!-- DateTime -->
          <div class="form-group">
            <label for="form79textarea" class="pl-1">DESCRIPTION:</label>
            <textarea type="text" id="form79textarea" class="md-textarea form-control" rows="3"></textarea>

          </div>

        </div>

        <!--Footer-->
        <div class="modal-footer justify-content-center">
          <a type="button" id="goTime" class="btn btn-primary waves-effect waves-light">Send
            <i class="fa fa-paper-plane ml-1"></i>
          </a>
        </div>
      </div>
    </div>
  </div>


  <!-- SCRIPTS -->
  <!-- JQuery -->
  <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
  <!-- Bootstrap tooltips -->
  <script type="text/javascript" src="js/popper.min.js"></script>
  <!-- Bootstrap core JavaScript -->
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <!-- MDB core JavaScript -->
  <script type="text/javascript" src="js/mdb.min.js"></script>
  
  <script type="text/javascript" src="./js/app.js"></script>
  <script type="text/javascript" src="./js/weather.js"></script>
  <script>
      let aValue = localStorage.getItem('newUser');
      let currentUser = aValue.split(',')[1].split(':')[1].replace(/['"]+/g, '');
      var nameOfUser = $('#currentUser');
      let currentEmail = aValue.split(',')[2].split(':')[1].replace(/['"]+/g, '');
      console.log(currentUser);
      console.log(currentEmail);
      var allEvents = $('#allEvents');
      var listPugs = $('#listPugs');
      var events;
      $(document).ready(function(){
          $.get('/findall', function(data){
              type: 'GET'
              events = data; 
              initializeEvents(events);
            })
            
        function userName () {
            let name = $('<h4>');
                name.addClass('card-title');
                name.addClass('text-center');
                name.text(currentUser);
                nameOfUser.append(name);
            }
                
            userName();

        function initializeEvents(events){
            allEvents.empty();
            var eventsToAdd = [];
            console.log(events);
            for (let i=0; i<events.length; i++){
                console.log(i);
                eventsToAdd.push(createNewEvent(events[i]))
            }
            allEvents.prepend(eventsToAdd);
            console.log(eventsToAdd);
            }

        function createNewEvent (events) {
            let event = $('<div>');
            let body = $('<div>');
            let city = $('<p>');
            let name = $('<h4>');
            let time = $('<p>');
            let descript = $('<p>');
            let btn = $('<button>')
            event.addClass("card");
            event.addClass("eventRendering");
            body.addClass('card-body');
            time.addClass('float-right');
            name.addClass('bold');
            city.addClass('bold');
            btn.attr('type', 'button');
            btn.attr('event', events.name);
            btn.attr('time', events.StartTime);
            btn.attr("email", currentEmail);
            btn.addClass('join');
            btn.addClass('btn btn-primary');
            btn.text('Join');
            descript.text(events.description);
            time.text(events.StartTime);
            name.text(events.name);
            city.text(events.city);
            body.append(name);
            body.append(time);
            body.append(city);
            body.append(descript);
            body.append(btn);
            event.append(body);
            return event; 
        }

        $(document).on('click', '.join', function(event){
            var time = $(this).attr('time');
            var name = $(this).attr('event');
            var email = $(this).attr('email');
            console.log(event);

            let myPug = $('<li>');
            myPug.text(name+' '+time);
            myPug.addClass('list-group')
            listPugs.append(myPug);

            $.get('/sendmail/'+time+'/'+name + '/' +email, function(){
              type: 'GET'              
            })
        })

        $('#goTime').on('click', function(event){
            event.preventDefault();
            var newEvent = {
                name: $('#materialContactFormName').val().trim(),
                city: $('#event_Loc').val().trim(),
                StartTime: $('#event_Time').val(),
                description: $('#form79textarea').val().trim()
            }
            console.log(newEvent)
            $.post('/newevent', {
                type: 'POST',
                data: newEvent
            }).then(function(result){
                console.log(result);
                location.reload();
            });
        }) 
      })
    
  </script>
</body>

</html>